# 时间块 (TimeBlock) 逻辑文档

本文档描述了系统当前的时间块逻辑，包括来源类型、视觉表现及交互状态。

## 1. SourceType（来源类型）定义
`sourceType` 存储在数据库的 `TimeBlock` 表中，用于标识时间块的产生方式。

| 枚举值 | 中文含义 | 描述 |
| :--- | :--- | :--- |
| `manual_entry` | 手动创建 | 用户在时间轴上手动添加的计划或记录。 |
| `task_plan` | 任务计划 | 从任务列表拖拽或生成的计划时间块。 |
| `fixed_break` | 固定休息 | 根据“固定休息规则”自动生成的休息时间（如午休）。 |
| `pomodoro_log` | 番茄记录 | 完成专注后自动生成的实际执行记录。 |
| `time_log` | 时间日志 | 通常指已完成并记录的普通时间块。 |

---

## 2. 视觉表现 (Visual Representation)

UI 表现主要由 `isLogged`（是否已记录）、`isCurrentBlock`（是否为当前时间）和 `sourceType` 共同决定。
逻辑已在 `TimelineBlockItemContent` 组件中统一为 `SOURCE_TYPE_CONFIG`。

### 2.1 状态样式分类

| 状态 | 判定条件 | 视觉样式 (Theme) | 边框/背景特征 |
| :--- | :--- | :--- | :--- |
| **正在进行** | `isCurrentBlock = true` | **蓝色 (Blue)** | 实线蓝边框 + 外发光 (Ring) + 阴影 + 浅蓝背景 |
| **固定休息** | `sourceType = 'fixed_break'` | **绿色 (Green)** | 绿边框 + 浅绿背景 |
| **计划项** | `manual_entry` / `task_plan` (未记录) | **靛青 (Indigo)** | **虚线边框** + 浅靛青背景 (与正在进行区分) |
| **已记录** | `isLogged = 1` | **白色/灰色** | 灰边框 + 白色/深色背景 |

### 2.2 图标逻辑 (Icons)

左侧圆形指示器根据状态动态变化：

1.  **最高优先级状态**：
    *   若 `isCurrentBlock` (当前)：显示 `Loader2` (旋转加载)。
    *   若 `isLogged` (已记录)：显示 `CheckCircle2` (勾选)。

2.  **默认类型图标** (由 `SOURCE_TYPE_CONFIG` 定义)：
    *   `fixed_break`: `Coffee` (咖啡)
    *   `task_plan`: `ClipboardCheck` (剪贴板)
    *   `manual_entry`: `Pencil` (铅笔)
    *   `pomodoro_log`: `Timer` (计时器)
    *   `default`: `Activity` (波形)

### 2.3 动效 (Animations)

*   **旋转 (Spin)**: 当 `isCurrentBlock` 为真时，左侧 `Loader2` 图标会无限旋转。
*   **脉冲 (Pulse)**: 当 `isCurrentBlock` 为真时，标题前的计时器小图标会有呼吸灯效果。

---

## 3. “当前时间块”判断逻辑

*   **更新频率**: 系统每秒更新一次 `currentTime` (在 `TimelineCard` 组件中)。
*   **判断公式**: `currentTime >= block.startTime && currentTime < block.endTime`
*   **联动效果**:
    1.  自动应用“正在进行”的蓝色高亮样式。
    2.  启用旋转和呼吸灯动效。
